<!-- FILE:templates/apps/stats.html -->
<!--Body content-->
<div id="content" class="clearfix">
    <div class="contentwrapper"><!--Content wrapper-->
        <!-- Build page from here: -->
        <div class="row-fluid">
          <div class="span12">
            <div class="page-header">
                <h1>App Console for {{ app_id }}</h1>
            </div><!--close header-->
              <div class="row-fluid">
                <div class="offset1 span8">
                  <div class="flot-container">
			            <div id="app-flot" class="flot-placeholder"></div>
		          </div>
                    <div style="margin-right:auto; margin-left:auto;" id="countdown">
                    <p>Please wait <span id="timer"></span> seconds for data to populate.</p>
                    </div>
                  </div>
              </div>
        </div><!--close span6 -->
        </div> <!-- end row fluid -->
    </div> <!-- end content wrapper -->
</div> <!--end content-->

<script>
//Plots JSON data on a line graph
window.onload = function() {setInterval(function() {
    $.ajax({
        url: "/apps/stats/requests?appid={{ appid }}",
    }).done(function(json_data) {
        var req_info = JSON.parse(json_data);
        var thetuples = [];
        for (var index = 0; index < req_info.length; index++) {
          var x = req_info[index]['timestamp'] * 1000;
          var y = req_info[index]['num_of_requests'];
          thetuples.push([x, y]);
        }
        $.plot($("#app-flot"), [thetuples], { xaxis: { mode: "time", timezone: "browser", timeformat: "%m/%d %H:%M:%S"} });
    });
}, 20000);
    }

//Sets countdown timer for data population
var time = 21;
window.setInterval(timer, 1000);

function timer()
{
             time -=1;
    $('#timer').html(time);

if(time == 0)
{
    $('#countdown').remove();
}
}

</script>