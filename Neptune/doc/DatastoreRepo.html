<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: DatastoreRepo</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>

</head>
<body class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./lib/datastores/datastore_repo_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/datastores/datastore_repo.rb">lib/datastores/datastore_repo.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="Object.html">Object</a></p>
        
      </div>
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-do_http_get_for_get">#do_http_get_for_get</a></li>
          
          <li><a href="#method-i-do_http_post_for_set">#do_http_post_for_set</a></li>
          
          <li><a href="#method-i-does_file_exist-3F">#does_file_exist?</a></li>
          
          <li><a href="#method-i-get_acl">#get_acl</a></li>
          
          <li><a href="#method-i-get_output_and_return_contents">#get_output_and_return_contents</a></li>
          
          <li><a href="#method-i-get_output_and_save_to_fs">#get_output_and_save_to_fs</a></li>
          
          <li><a href="#method-i-set_acl">#set_acl</a></li>
          
          <li><a href="#method-i-write_remote_file_from_local_file">#write_remote_file_from_local_file</a></li>
          
          <li><a href="#method-i-write_remote_file_from_string">#write_remote_file_from_string</a></li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./NeptuneManager.html">NeptuneManager</a></li>
        
          <li><a href="./NeptuneManager/Djinn.html">NeptuneManager::Djinn</a></li>
        
          <li><a href="./BadConfigurationException.html">BadConfigurationException</a></li>
        
          <li><a href="./Datastore.html">Datastore</a></li>
        
          <li><a href="./DatastoreFactory.html">DatastoreFactory</a></li>
        
          <li><a href="./DatastoreRepo.html">DatastoreRepo</a></li>
        
          <li><a href="./DatastoreRepoOnAppEngine.html">DatastoreRepoOnAppEngine</a></li>
        
          <li><a href="./DatastoreRepoOnAppScale.html">DatastoreRepoOnAppScale</a></li>
        
          <li><a href="./DatastoreS3.html">DatastoreS3</a></li>
        
          <li><a href="./Djinn.html">Djinn</a></li>
        
          <li><a href="./EngineFactory.html">EngineFactory</a></li>
        
          <li><a href="./GoogleAppEnginePullQueue.html">GoogleAppEnginePullQueue</a></li>
        
          <li><a href="./GoogleAppEnginePushQueue.html">GoogleAppEnginePushQueue</a></li>
        
          <li><a href="./HelperFunctions.html">HelperFunctions</a></li>
        
          <li><a href="./NeptuneJobData.html">NeptuneJobData</a></li>
        
          <li><a href="./NeptuneManagerServer.html">NeptuneManagerServer</a></li>
        
          <li><a href="./Object.html">Object</a></li>
        
          <li><a href="./QueueFactory.html">QueueFactory</a></li>
        
          <li><a href="./TaskEngine.html">TaskEngine</a></li>
        
          <li><a href="./TaskEngineAppScale.html">TaskEngineAppScale</a></li>
        
          <li><a href="./TaskEngineGoogleAppEngine.html">TaskEngineGoogleAppEngine</a></li>
        
          <li><a href="./TaskQueue.html">TaskQueue</a></li>
        
          <li><a href="./TaskQueueAzureQueue.html">TaskQueueAzureQueue</a></li>
        
          <li><a href="./TaskQueueGoogleAppEngine.html">TaskQueueGoogleAppEngine</a></li>
        
          <li><a href="./TaskQueueRabbitMQ.html">TaskQueueRabbitMQ</a></li>
        
          <li><a href="./TaskQueueSQS.html">TaskQueueSQS</a></li>
        
          <li><a href="./UserAppClient.html">UserAppClient</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">DatastoreRepo</h1>

    <div id="description">
      
<p>A class that abstracts away access to our Repository application (also
known as the Repo). Since it’s a web application, it can be hosted
anywhere, and thus this class dictates what we expect the application to
return. Implementers of this class need only tell us where we can expect to
find the Repo application and how to make sure it’s running there.</p>

    </div>

    <!-- Constants -->
    
    <div id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt><a name="NAME">NAME</a></dt>
        
        <dd class="description"><p>The name of this datastore, which <a
href="DatastoreFactory.html">DatastoreFactory</a> will use to find this <a
href="Datastore.html">Datastore</a>. Implementers should use a unique name
amongst <a href="Datastore.html">Datastore</a> implementers.</p></dd>
        
      
      </dl>
    </div>
    

    <!-- Attributes -->
    
    <div id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="host-attribute-method" class="method-detail">
        <a name="host"></a>
        
        <a name="host="></a>
        
        <div class="method-heading attribute-method-heading">
          <span class="method-name">host</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>The host (IP:port) that the Repo app is hosted at.</p>
        
        </div>
      </div>
      
    </div>
    

    <!-- Methods -->
    
    <div id="public-instance-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="do_http_get_for_get-method" class="method-detail ">
        <a name="method-i-do_http_get_for_get"></a>

        
        <div class="method-heading">
          <span class="method-name">do_http_get_for_get</span><span
            class="method-args">(repo_path, type)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>A convenience method that can be used to perform GET requests on the Repo
app, returning whatever it returns.</p>
          

          
          <div class="method-source-code"
            id="do_http_get_for_get-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 111</span>
def do_http_get_for_get(repo_path, type)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;Performing a get on key [#{repo_path}], type [#{type}]&quot;)
  get_url = &quot;http://#{@host}/get&quot;
  params = {<span class="ruby-string">'SECRET'</span> =&gt; <span class="ruby-constant">HelperFunctions</span>.get_secret(), <span class="ruby-string">'KEY'</span> =&gt; repo_path, 
    <span class="ruby-string">'TYPE'</span> =&gt; type}
  data = <span class="ruby-constant">Net</span>::<span class="ruby-constant">HTTP</span>.post_form(<span class="ruby-constant">URI</span>.parse(get_url), params).body
  return <span class="ruby-constant">Base64</span>.decode64(data)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="do_http_post_for_set-method" class="method-detail ">
        <a name="method-i-do_http_post_for_set"></a>

        
        <div class="method-heading">
          <span class="method-name">do_http_post_for_set</span><span
            class="method-args">(repo_path, type, val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>A convenience method that can be used to perform POST requests on the Repo
app, returning a boolean corresponding to if the operation succeeded.</p>
          

          
          <div class="method-source-code"
            id="do_http_post_for_set-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 123</span>
def do_http_post_for_set(repo_path, type, val)
  encoded_val = <span class="ruby-constant">Base64</span>.encode64(val)
  set_url = &quot;http://#{@host}/set&quot;
  params = {<span class="ruby-string">'SECRET'</span> =&gt; <span class="ruby-constant">HelperFunctions</span>.get_secret(), <span class="ruby-string">'KEY'</span> =&gt; repo_path,
    <span class="ruby-string">'VALUE'</span> =&gt; encoded_val, <span class="ruby-string">'TYPE'</span> =&gt; type}
  result = <span class="ruby-constant">Net</span>::<span class="ruby-constant">HTTP</span>.post_form(<span class="ruby-constant">URI</span>.parse(set_url), params).body
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;set key=#{repo_path} type=#{type} returned #{result}&quot;)
  if result == <span class="ruby-string">&quot;success&quot;</span>
    return true
  else
    return false
  end
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="does_file_exist-3F-method" class="method-detail ">
        <a name="method-i-does_file_exist-3F"></a>

        
        <div class="method-heading">
          <span class="method-name">does_file_exist?</span><span
            class="method-args">(repo_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Queries the Repo app to see if the given file exists.</p>
          

          
          <div class="method-source-code"
            id="does_file_exist-3F-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 96</span>
def does_file_exist?(repo_path)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;Performing a does_file_exist? on file [#{repo_path}]&quot;)
  exists_url = &quot;http://#{@host}/doesexist&quot;
  params = {<span class="ruby-string">'SECRET'</span> =&gt; <span class="ruby-constant">HelperFunctions</span>.get_secret(), <span class="ruby-string">'KEY'</span> =&gt; repo_path}
  result = <span class="ruby-constant">Net</span>::<span class="ruby-constant">HTTP</span>.post_form(<span class="ruby-constant">URI</span>.parse(exists_url), params).body
  if result == <span class="ruby-string">&quot;true&quot;</span>
    return true
  else
    return false
  end
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="get_acl-method" class="method-detail ">
        <a name="method-i-get_acl"></a>

        
        <div class="method-heading">
          <span class="method-name">get_acl</span><span
            class="method-args">(repo_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Retrieves the access policy for the given file.</p>
          

          
          <div class="method-source-code"
            id="get_acl-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 82</span>
def get_acl(repo_path)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;Attempting to get acl for file [#{repo_path}]&quot;)
  return do_http_get_for_get(repo_path, :acl)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="get_output_and_return_contents-method" class="method-detail ">
        <a name="method-i-get_output_and_return_contents"></a>

        
        <div class="method-heading">
          <span class="method-name">get_output_and_return_contents</span><span
            class="method-args">(repo_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns the output of the given file as a string.</p>
          

          
          <div class="method-source-code"
            id="get_output_and_return_contents-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 41</span>
def get_output_and_return_contents(repo_path)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;Attempting to get output for file [#{repo_path}]&quot;)
  return do_http_get_for_get(repo_path, :output)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="get_output_and_save_to_fs-method" class="method-detail ">
        <a name="method-i-get_output_and_save_to_fs"></a>

        
        <div class="method-heading">
          <span class="method-name">get_output_and_save_to_fs</span><span
            class="method-args">(repo_path, local_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Writes the contents of the remotely specified file to the local filesystem.</p>
          

          
          <div class="method-source-code"
            id="get_output_and_save_to_fs-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 34</span>
def get_output_and_save_to_fs(repo_path, local_path)
  data = get_output_and_return_contents(repo_path)
  <span class="ruby-constant">HelperFunctions</span>.write_file(local_path, data)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="set_acl-method" class="method-detail ">
        <a name="method-i-set_acl"></a>

        
        <div class="method-heading">
          <span class="method-name">set_acl</span><span
            class="method-args">(repo_path, acl)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Sets the access policy for the given file hosted in the Repo.</p>
          

          
          <div class="method-source-code"
            id="set_acl-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 89</span>
def set_acl(repo_path, acl)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;Attempting to set acl to [#{acl}] for file #{repo_path}&quot;)
  return do_http_post_for_set(repo_path, :acl, acl)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="write_remote_file_from_local_file-method" class="method-detail ">
        <a name="method-i-write_remote_file_from_local_file"></a>

        
        <div class="method-heading">
          <span class="method-name">write_remote_file_from_local_file</span><span
            class="method-args">(repo_path, local_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Writes the contents of the given file to a file hosted in the Repo. If the
given file is a directory, we also write all files / directories found in
that directory.</p>
          

          
          <div class="method-source-code"
            id="write_remote_file_from_local_file-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 50</span>
def write_remote_file_from_local_file(repo_path, local_path)
  if <span class="ruby-constant">File</span>.directory?(local_path)
    files_to_upload = <span class="ruby-constant">HelperFunctions</span>.shell(&quot;ls #{local_path}&quot;)
    files_to_upload.split.each { |file|
      full_repo_path = repo_path + <span class="ruby-string">&quot;/&quot;</span> + file
      full_local_path = local_path + <span class="ruby-string">&quot;/&quot;</span> + file
      <span class="ruby-constant">Djinn</span>.log_debug(<span class="ruby-string">&quot;Recursive dive - now saving remote &quot;</span> +
        &quot;[#{full_repo_path}], local [#{full_local_path}]&quot;)
      temp = write_remote_file_from_local_file(full_repo_path, full_local_path)
      if !temp
        <span class="ruby-constant">Djinn</span>.log_debug(&quot;Setting remote [#{full_repo_path}] failed - reported [#{temp}]&quot;)
        return false
      end
    }

    return true
  else
    <span class="ruby-constant">Djinn</span>.log_debug(&quot;Attempting to put local file #{local_path} into file #{repo_path}&quot;)
    val = <span class="ruby-constant">HelperFunctions</span>.read_file(local_path, chomp=false)
    return do_http_post_for_set(repo_path, :output, val)
  end
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="write_remote_file_from_string-method" class="method-detail ">
        <a name="method-i-write_remote_file_from_string"></a>

        
        <div class="method-heading">
          <span class="method-name">write_remote_file_from_string</span><span
            class="method-args">(repo_path, string)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Writes the contents of the given string to a file hosted in the Repo.</p>
          

          
          <div class="method-source-code"
            id="write_remote_file_from_string-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 75</span>
def write_remote_file_from_string(repo_path, string)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;Attempting to put local file into location #{repo_path}&quot;)
  return do_http_post_for_set(repo_path, :output, string)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
    </div>
  
    <div id="public-class-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="new-method" class="method-detail ">
        <a name="method-c-new"></a>

        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(credentials)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Creates a new connection to the Repo running on AppScale. Since AppScale
starts the Repo automatically, this initialization does not start it or
verify that it is running (although it perhaps should do the latter).</p>
          

          
          <div class="method-source-code"
            id="new-source">
<pre>
<span class="ruby-comment"># File lib/datastores/datastore_repo.rb, line 28</span>
def initialize(credentials)
  raise <span class="ruby-constant">NotImplementedError</span>.new(<span class="ruby-string">&quot;Can't init an abstract Repo&quot;</span>)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
    </div>
  

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

