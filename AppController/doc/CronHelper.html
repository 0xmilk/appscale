<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Module: CronHelper</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>

</head>
<body class="module">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./lib/cron_helper_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/cron_helper.rb">lib/cron_helper.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-clear_crontab">::clear_crontab</a></li>
          
          <li><a href="#method-c-update_cron">::update_cron</a></li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./AppControllerClient.html">AppControllerClient</a></li>
        
          <li><a href="./BadConfigurationException.html">BadConfigurationException</a></li>
        
          <li><a href="./BlobServer.html">BlobServer</a></li>
        
          <li><a href="./Collectd.html">Collectd</a></li>
        
          <li><a href="./CronHelper.html">CronHelper</a></li>
        
          <li><a href="./Datastore.html">Datastore</a></li>
        
          <li><a href="./DatastoreFactory.html">DatastoreFactory</a></li>
        
          <li><a href="./DatastoreRepo.html">DatastoreRepo</a></li>
        
          <li><a href="./DatastoreRepoOnAppEngine.html">DatastoreRepoOnAppEngine</a></li>
        
          <li><a href="./DatastoreRepoOnAppScale.html">DatastoreRepoOnAppScale</a></li>
        
          <li><a href="./DatastoreS3.html">DatastoreS3</a></li>
        
          <li><a href="./Djinn.html">Djinn</a></li>
        
          <li><a href="./DjinnJobData.html">DjinnJobData</a></li>
        
          <li><a href="./DjinnServer.html">DjinnServer</a></li>
        
          <li><a href="./Ejabberd.html">Ejabberd</a></li>
        
          <li><a href="./EngineFactory.html">EngineFactory</a></li>
        
          <li><a href="./FailedZooKeeperOperationException.html">FailedZooKeeperOperationException</a></li>
        
          <li><a href="./GodInterface.html">GodInterface</a></li>
        
          <li><a href="./GoogleAppEnginePullQueue.html">GoogleAppEnginePullQueue</a></li>
        
          <li><a href="./GoogleAppEnginePushQueue.html">GoogleAppEnginePushQueue</a></li>
        
          <li><a href="./HAProxy.html">HAProxy</a></li>
        
          <li><a href="./HelperFunctions.html">HelperFunctions</a></li>
        
          <li><a href="./JSONClient.html">JSONClient</a></li>
        
          <li><a href="./LoadBalancer.html">LoadBalancer</a></li>
        
          <li><a href="./Monitoring.html">Monitoring</a></li>
        
          <li><a href="./NeptuneJobData.html">NeptuneJobData</a></li>
        
          <li><a href="./Nginx.html">Nginx</a></li>
        
          <li><a href="./Object.html">Object</a></li>
        
          <li><a href="./PbServer.html">PbServer</a></li>
        
          <li><a href="./QueueFactory.html">QueueFactory</a></li>
        
          <li><a href="./RabbitMQ.html">RabbitMQ</a></li>
        
          <li><a href="./Repo.html">Repo</a></li>
        
          <li><a href="./TaskEngine.html">TaskEngine</a></li>
        
          <li><a href="./TaskEngineAppScale.html">TaskEngineAppScale</a></li>
        
          <li><a href="./TaskEngineGoogleAppEngine.html">TaskEngineGoogleAppEngine</a></li>
        
          <li><a href="./TaskQueue.html">TaskQueue</a></li>
        
          <li><a href="./TaskQueueAzureQueue.html">TaskQueueAzureQueue</a></li>
        
          <li><a href="./TaskQueueGoogleAppEngine.html">TaskQueueGoogleAppEngine</a></li>
        
          <li><a href="./TaskQueueRabbitMQ.html">TaskQueueRabbitMQ</a></li>
        
          <li><a href="./TaskQueueSQS.html">TaskQueueSQS</a></li>
        
          <li><a href="./UserAppClient.html">UserAppClient</a></li>
        
          <li><a href="./ZKInterface.html">ZKInterface</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="module">CronHelper</h1>

    <div id="description">
      
<p>A module that abstracts away interactions with our implementation of the
Google App Engine Cron API. It lets users write specifications for how
often URLs in their web app should be accessed, and turns that into
standard cron jobs.</p>

    </div>

    <!-- Constants -->
    

    <!-- Attributes -->
    

    <!-- Methods -->
    
    <div id="public-class-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="clear_crontab-method" class="method-detail ">
        <a name="method-c-clear_crontab"></a>

        
        <div class="method-heading">
          <span class="method-name">clear_crontab</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="clear_crontab-source">
<pre>
<span class="ruby-comment"># File lib/cron_helper.rb, line 72</span>
def self.clear_crontab
  `crontab -r`  
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="update_cron-method" class="method-detail ">
        <a name="method-c-update_cron"></a>

        
        <div class="method-heading">
          <span class="method-name">update_cron</span><span
            class="method-args">(ip, lang, app)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code"
            id="update_cron-source">
<pre>
<span class="ruby-comment"># File lib/cron_helper.rb, line 12</span>
def self.update_cron(ip, lang, app)
  <span class="ruby-constant">Djinn</span>.log_debug(&quot;saw a cron request with args [#{ip}][#{lang}][#{app}]&quot;) 

  if lang == <span class="ruby-string">&quot;python&quot;</span>
    cron_file = &quot;/var/apps/#{app}/app/cron.yaml&quot;
    return unless <span class="ruby-constant">File</span>.exists?(cron_file)
    cron_yaml = <span class="ruby-constant">YAML</span>.load_file(cron_file)[<span class="ruby-string">&quot;cron&quot;</span>]
    return if cron_yaml.nil?
    cron_yaml.each { |item|
      description = item[<span class="ruby-string">&quot;description&quot;</span>]
      <span class="ruby-comment"># since url gets put at end of curl, need to ensure it</span>
      <span class="ruby-comment"># is of the form /baz to prevent malicious urls</span>
      url = item[<span class="ruby-string">&quot;url&quot;</span>].scan(<span class="ruby-regexp">/\A(\/[\/\d\w]+)/</span>).flatten.to_s
      schedule = item[<span class="ruby-string">&quot;schedule&quot;</span>]
      timezone = item[<span class="ruby-string">&quot;timezone&quot;</span>] <span class="ruby-comment"># will add support later for this</span>
      cron_scheds = convert_schedule_to_cron(schedule, url, ip, app)
      cron_scheds.each { |line|
      <span class="ruby-comment">#  cron_info = &lt;&lt;CRON</span>
      <span class="ruby-comment">#  Description: #{description}</span>
      <span class="ruby-comment">#  URL: #{url}</span>
      <span class="ruby-comment">#  Schedule: #{schedule}</span>
      <span class="ruby-comment">#  TimeZone: #{timezone}</span>
      <span class="ruby-comment">#  Cron Schedule: #{line}</span>
      <span class="ruby-comment">#CRON</span>
      <span class="ruby-comment">#  Djinn.log_debug(cron_info)</span>
        <span class="ruby-constant">Djinn</span>.log_debug(&quot;Adding cron line: [#{line}]&quot;)
        add_line_to_crontab(line)
      }
    }
  elsif lang == <span class="ruby-string">&quot;java&quot;</span>
    cron_file = &quot;/var/apps/#{app}/app/war/WEB-INF/cron.xml&quot;
    return unless <span class="ruby-constant">File</span>.exists?(cron_file)
    cron_xml = <span class="ruby-constant">Document</span>.new(<span class="ruby-constant">File</span>.new(cron_file)).root
    return if cron_xml.nil?
    cron_xml.each_element(<span class="ruby-string">'//cron'</span>) { |item|
      description = get_from_xml(item, <span class="ruby-string">&quot;description&quot;</span>)
      <span class="ruby-comment"># since url gets put at end of curl, need to ensure it</span>
      <span class="ruby-comment"># is of the form /baz to prevent malicious urls</span>
      url = get_from_xml(item, <span class="ruby-string">&quot;url&quot;</span>).scan(<span class="ruby-regexp">/\A(\/[\/\d\w]+)/</span>).flatten.to_s
      schedule = get_from_xml(item, <span class="ruby-string">&quot;schedule&quot;</span>)
      timezone = get_from_xml(item, <span class="ruby-string">&quot;timezone&quot;</span>) <span class="ruby-comment"># will add support later for this</span>
      cron_scheds = convert_schedule_to_cron(schedule, url, ip, app)
      cron_scheds.each { |line|
      <span class="ruby-comment">#  cron_info = &lt;&lt;CRON</span>
      <span class="ruby-comment">#  Description: #{description}</span>
      <span class="ruby-comment">#  URL: #{url}</span>
      <span class="ruby-comment">#  Schedule: #{schedule}</span>
      <span class="ruby-comment">#  TimeZone: #{timezone}</span>
      <span class="ruby-comment">#  Cron Schedule: #{line}</span>
      <span class="ruby-comment">#CRON</span>
      <span class="ruby-comment">#  Djinn.log_debug(cron_info)</span>
        <span class="ruby-constant">Djinn</span>.log_debug(&quot;Adding cron line: [#{line}]&quot;)
        add_line_to_crontab(line)
      }
    }
  else
    abort(&quot;cron: lang was neither python nor java but was [#{lang}]&quot;)
  end
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
    </div>
  

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

